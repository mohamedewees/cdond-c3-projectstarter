---
  - name: install rsync on the ansible controller
    become: true
    connection: local
    package:
      name: 
        - openssh
        - rsync
      state: present
      
  - name: "move files to server"
    become: true
    synchronize:
      src: /root/project/backend/
      dest: ./udapeople
      recursive: true

  - name: "move node modules"
    become: true
    synchronize:
      src: /root/project/backend/node_modules
      dest: ./udapeople
      recursive: true

# - name: "install apps"
#   become: true
#     # npm:
#     #   name: pm2
#     #   global: yes
#   shell: |
#     cd /home/ubuntu/udapeople/dist
#     pm2 stop default
#     pm2 start main.js 
      
#   environment:
#     TYPEORM_CONNECTION: "{{ lookup('env', 'TYPEORM_CONNECTION')}}"
#     TYPEORM_ENTITIES: "{{ lookup('env', 'TYPEORM_ENTITIES')}}"
#     TYPEORM_HOST: "{{ lookup('env', 'TYPEORM_HOST')}}"
#     TYPEORM_PORT: "5432"
#     TYPEORM_USERNAME: "{{ lookup('env', 'TYPEORM_USERNAME')}}"
#     TYPEORM_PASSWORD: "{{ lookup('env', 'TYPEORM_PASSWORD')}}"
#     TYPEORM_DATABASE: "{{ lookup('env', 'TYPEORM_DATABASE')}}"
#     TYPEORM_MIGRATIONS: "{{ lookup('env', 'TYPEORM_MIGRATIONS')}}"
#     TYPEORM_MIGRATIONS_DIR: "{{ lookup('env', 'TYPEORM_MIGRATIONS_DIR')}}"
    